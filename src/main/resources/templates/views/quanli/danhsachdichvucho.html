<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Danh sách chờ dịch vụ</title>
<!-- Boxicons CSS -->
<link href='https://unpkg.com/boxicons@2.1.1/css/boxicons.min.css'
	rel='stylesheet'>
<!-- Google Font -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link th:href="@{/css/style-km.css}" rel="stylesheet" />
link css

<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link
	href="https://fonts.googleapis.com/css2?family=Nunito+Sans:wght@200..1000&family=Poppins:wght@100..900&display=swap"
	rel="stylesheet">
<link th:href="@{/css/style-admin.css}" rel="stylesheet" />
<!-- Bootstrap CSS -->
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
	rel="stylesheet" crossorigin="anonymous" />
<script
	src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/js/all.min.js"
	crossorigin="anonymous"></script>
<style>
.main-content {
	padding: 0;
}

.luunut {
	background-color: var(--portland-orange);
	color: white;
	border: 1px solid var(--portland-orange);
	transition: background-color 0.3s, border 0.3s;
}

.luunut:hover, .luunut:active {
	background-color: var(--amber);
	border: 1px solid var(--amber);
}

.luunut:focus {
	outline: none;
	box-shadow: none;
}

body.modal-open {
	overflow-y: hidden;
	padding-right: 0 !important;
}

.modal-dialog {
	transform: none !important;
	transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
}

.modal.fade.show {
	opacity: 1;
}

a {
	text-decoration: none;
}

body.modal-open {
	padding-right: 0 !important; /* Ngăn trang bị thụt lề khi mở modal */
	overflow-y: auto; /* Đảm bảo cuộn vẫn hoạt động */
}
</style>
</head>
<body>
	<nav th:replace="~{views/layout/header :: nav}"></nav>
	<aside th:replace="~{views/layout/aside :: aside}"></aside>
	<article class="container" style="padding-top: 6%; padding-bottom: 5%;">
		<div class="main-content">
			<div class="box-work">
				<div class="title">
					<h1>
						<b>Danh Sách</b> <span class="edit_text-title"> Chờ Dịch Vụ</span>
					</h1>

					<div class="row">
						<div class="col-md-5">
							<input type="text" class="form-control" id="searchInput"
								onkeyup="filterTable3()" placeholder="Tìm kiếm dịch vụ">
						</div>
						<div class="col-md-4">
							<input type="text" class="form-control" id="searchInput2"
								onkeyup="filterTable4()" placeholder="Tìm kiếm trạng thái">
						</div>
					</div>

				</div>
				<div class="container my-5">
					<div class="table-container">
						<table class="table table-striped text-center" id="myTable">
							<thead class="table-light">
								<tr>
									<th>Số thứ tự</th>
									<th>Họ và tên</th>
									<th>Số điện thoại</th>
									<th>Ngày đặt</th>
									<th>Ngày thực hiện</th>
									<th>Tên Dịch Vụ</th>
									<th>Trạng Thái</th>
									<th>Hành Động</th>
								</tr>
							</thead>
							<tbody id="table-body">
								<tr th:each="dichVu, iterStat : ${listDichVu}">
									<!-- Số thứ tự -->
									<td th:text="${iterStat.index + 1}">Số thứ tự</td>

									<!-- Họ và tên tài khoản -->
									<td
										th:text="${dichVu.taiKhoan != null ? dichVu.taiKhoan.hoTen : 'Không có tên'}">Họ
										và tên</td>

									<!-- Số điện thoại -->
									<td
										th:text="${dichVu.taiKhoan != null ? dichVu.taiKhoan.soDienThoai : 'Không có số điện thoại'}">Số
										điện thoại</td>

									<!-- Ngày đặt -->
									<td
										th:text="${dichVu.ngayDat != null ? #dates.format(dichVu.ngayDat, 'dd/MM/yyyy') : 'Không xác định'}">Ngày
										đặt</td>

									<!-- Ngày thực hiện -->
									<td th:if="${dichVu.trangThai}"
										th:text="${dichVu.ngayThucHien != null ? #dates.format(dichVu.ngayThucHien, 'dd/MM/yyyy') : 'Không xác định'}">Ngày
										thực hiện</td>
									<td th:if="!${dichVu.trangThai}">-</td>

									<!-- Tên dịch vụ -->
									<td
										th:text="${dichVu.dichVu != null ? dichVu.dichVu.tenDichVu : 'Không có dịch vụ'}">Tên
										dịch vụ</td>

									<!-- Trạng thái -->
									<td class="text-start"
										th:text="${dichVu.trangThai ? 'Đã nhận' : 'Chưa nhận'}">Trạng
										thái</td>

									<!-- Thao tác -->
									<td>
										<!-- Nút Đổi --> <a th:if="!${dichVu.trangThai}" href="#"
										onclick="showConfirmModal(this)"
										th:data-href="@{/employee/DSDVCho/doi/{datDichVuId}(datDichVuId=${dichVu.datDichVuId})}">
											<button class="btn btn-outline-primary mt-3 luunut">Đã Xác
												Nhận</button>
									</a>
										<button class="btn btn-outline-primary mt-3 luunut"
											th:if="${dichVu.trangThai}" disabled>Đã Nhận</button> <!-- Nút Chi tiết -->
										<button class="btn btn-outline-primary mt-3 luunut"
											data-bs-toggle="modal"
											th:data-bs-target="${'#detailModal-' + dichVu.datDichVuId}">
											Chi tiết</button>
									</td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
				<ul id="pagination" class="pagination justify-content-center">

				</ul>

				<!-- Modal hiển thị thông tin chi tiết -->
				<div th:each="dichVu : ${listDichVu}">
					<div class="modal fade"
						th:id="${'detailModal-' + dichVu.datDichVuId}" tabindex="-1"
						aria-hidden="true">
						<div class="modal-dialog">
							<div class="modal-content">
								<div class="modal-header">
									<h5 class="modal-title">Thông tin chi tiết thú cưng</h5>
									<button type="button" class="btn-close" data-bs-dismiss="modal"
										aria-label="Close"></button>
								</div>
								<div class="modal-body">
									<p>
										<b>Tên thú cưng:</b> <span
											th:text="${dichVu.thuCung?.tenThuCung ?: 'Không có tên'}"></span>
									</p>
									<p>
										<b>Giá dịch vụ:</b> <span
											th:text="${dichVu.dichVu?.giaDichVu ?: 'Không có tên'}"></span>
									</p>
									<p>
										<b>Loài:</b> <span th:if="${dichVu.thuCung?.loaiThuCung == 1}"
											th:text="'Gâu gâu'"></span> <span
											th:if="${dichVu.thuCung?.loaiThuCung == 2}"
											th:text="'Meo meo'"></span> <span
											th:if="${dichVu.thuCung == null || dichVu.thuCung.loaiThuCung == null}"
											th:text="'Không xác định'"></span>
									</p>
									<p>
										<b>Tháng Tuổi:</b> <span
											th:text="${dichVu.thuCung?.thangTuoi ?: 'Không xác định'}"></span>
									</p>
									<p>
										<b>Cân Nặng:</b> <span
											th:text="${dichVu.thuCung?.canNang ?: 'Không xác định'}"></span>
									</p>
									<p>
										<b>Ghi chú:</b> <span
											th:text="${dichVu.thuCung?.ghiChu ?: 'Không có ghi chú'}"></span>
									</p>
								</div>
								<div class="modal-footer">
									<button type="button" class="btn btn-secondary"
										data-bs-dismiss="modal">Đóng</button>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</article>
	<!-- Modal thông báo xác nhận -->
	<div class="modal fade" id="confirmChangeModal" tabindex="-1"
		aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title">Xác nhận thay đổi</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal"
						aria-label="Close"></button>
				</div>
				<div class="modal-body">Bạn có chắc chắn muốn thực hiện thay
					đổi này không?</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary"
						data-bs-dismiss="modal">Hủy</button>
					<button type="button" class="btn btn-primary"
						id="confirmChangeButton">Xác nhận</button>
				</div>
			</div>
		</div>
	</div>
	<!-- JavaScript Libraries -->
	<script th:src="@{/js/reload.js}"></script>
	<script th:src="@{/js/chart.js}"></script>
	<script th:src="@{/js/page.js}"></script>
	<script th:src="@{/js/app.js}"></script>
	<script th:src="@{/js/script-admin.js}"></script>
	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js"
		crossorigin="anonymous"></script>
	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
		crossorigin="anonymous"></script>
	<script>
//Pagination logic
  const itemsPerPage = 7;
  let currentPage = 1;

  function displayItems() {
      const rows = document.querySelectorAll('#table-body tr');
      const start = (currentPage - 1) * itemsPerPage;
      const end = start + itemsPerPage;

      rows.forEach((row, index) => {
          row.style.display = (index >= start && index < end) ? '' : 'none';
      });
  }

  function createPagination() {
      const rows = document.querySelectorAll('#table-body tr');
      const totalPages = Math.ceil(rows.length / itemsPerPage);
      const paginationContainer = document.getElementById('pagination');
      paginationContainer.innerHTML = ''; // Clear current pagination

      // Nút Previous
      const prevItem = document.createElement('li');
      prevItem.className = `page-item ${currentPage === 1 ? 'disabled' : ''}`;
      prevItem.innerHTML = `<a class="page-link" href="#" onclick="changePage('prev')"><<</a>`;
      paginationContainer.appendChild(prevItem);

      // Các nút trang
      for (let i = 1; i <= totalPages; i++) {
          const pageItem = document.createElement('li');
          pageItem.className = `page-item ${i === currentPage ? 'active' : ''}`;
          pageItem.innerHTML = `<a class="page-link" href="#" onclick="changePage(${i})">${i}</a>`;
          paginationContainer.appendChild(pageItem);
      }

      // Nút Next
      const nextItem = document.createElement('li');
      nextItem.className = `page-item ${currentPage === totalPages ? 'disabled' : ''}`;
      nextItem.innerHTML = `<a class="page-link" href="#" onclick="changePage('next')">>></a>`;
      paginationContainer.appendChild(nextItem);
  }

  function changePage(page) {
      const rows = document.querySelectorAll('#table-body tr');
      const totalPages = Math.ceil(rows.length / itemsPerPage);

      if (page === 'prev' && currentPage > 1) {
          currentPage--;
      } else if (page === 'next' && currentPage < totalPages) {
          currentPage++;
      } else if (typeof page === 'number') {
          currentPage = page;
      }

      displayItems();
      createPagination();
  }

  // Khởi tạo khi tải trang
  document.addEventListener('DOMContentLoaded', () => {
      displayItems();
      createPagination();
  });
let confirmHref = '';

function showConfirmModal(element) {
    // Lấy đường dẫn từ nút
    confirmHref = element.getAttribute('data-href');
    
    // Hiển thị modal
    const modal = new bootstrap.Modal(document.getElementById('confirmChangeModal'), {
        backdrop: 'static', // Modal không đóng khi nhấn ngoài
        keyboard: false      // Không đóng modal khi nhấn phím ESC
    });
    modal.show();
}

document.getElementById('confirmChangeButton').addEventListener('click', function () {
    if (!confirmHref) return;

    // Gửi yêu cầu bằng AJAX
    fetch(confirmHref, {
        method: 'GET'
    }).then(response => {
        if (response.ok) {
            return response.text();
        }
        throw new Error('Không thể thực hiện thay đổi');
    }).then(() => {
        // Tải lại toàn bộ trang sau khi thay đổi thành công
        location.reload(); 
    }).catch(error => {
        console.error('Lỗi:', error);
        alert('Có lỗi xảy ra, vui lòng thử lại sau.');
    }).finally(() => {
        // Đóng modal sau khi hoàn thành
        const modal = bootstrap.Modal.getInstance(document.getElementById('confirmChangeModal'));
        modal.hide();
    });


});

</script>
</body>
</html>
