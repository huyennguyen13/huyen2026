<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Quản lý hóa đơn</title>
<!-- ===== Boxicons CSS ===== -->
<link href='https://unpkg.com/boxicons@2.1.1/css/boxicons.min.css'
	rel='stylesheet'>
<!-- Linking Google Font Link For Icons -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link
	href="https://fonts.googleapis.com/css2?family=Nunito+Sans:ital,opsz,wght@0,6..12,200..1000;1,6..12,200..1000&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
	rel="stylesheet">
<link th:href="@{/css/style-admin.css}" rel="stylesheet" />

<!-- Bootstrap CSS v5.2.1 -->
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
	rel="stylesheet"
	integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
	crossorigin="anonymous" />
<!-- (Optional) Use CSS or JS implementation -->
<script
	src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/js/all.min.js"
	integrity="sha512-naukR7I+Nk6gp7p5TMA4ycgfxaZBJ7MO5iC3Fp6ySQyKFHOGfpkSZkYVWV5R7u7cfAicxanwYQ5D1e17EfJcMA=="
	crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script type="text/javascript"
	src="https://www.gstatic.com/charts/loader.js"></script>
<!-- Thư viện excel -->
<script
	src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<style>
.luunut {
	background-color: var(--portland-orange);
	color: white;
	border: 1px solid var(--portland-orange);
}

.luunut:hover {
	background-color: var(--amber);
	color: white;
	border: 1px solid var(--amber);
}

.luunut:active {
	background-color: var(--amber);
	color: white;
	border: 1px solid var(--amber);
}
/* Định dạng cho chế độ in */
@media print {
	body * {
		visibility: hidden;
	}
	@page {
		size: 80mm auto;
		margin: 10mm;
	}
	body {
		width: 80mm;
		font-size: 12px;
	}
	.form-container {
		max-width: 80mm;
	}
	.form-container, .form-container * {
		visibility: visible;
	}
	.form-container {
		position: absolute;
		top: 0;
		width: 100%;
	}
}
</style>

<body>

	<nav th:replace="~{views/layout/header :: nav}"></nav>
	<aside th:replace="~{views/layout/aside :: aside}"></aside>
	<!-- NOI DUNG O DAY -->
	<div class="box-work" style="padding-left: 100px; padding-top: 5%;">
		<div class="title">
			<h1>
				<b>Danh</b> <span class="edit_text-title">Sách</span>
			</h1>
		</div>

		<div class="row" style="margin: 0; padding: 0;">
			<div class="col-sm-7">
				<div class="table-hd card p-2">
					<table class="table table-hover">
						<thead>
							<tr>
								<th class="text-center">ID Hóa Đơn</th>
								<th class="text-center">Ngày</th>
								<th class="text-center">Khách Hàng</th>
								<th class="text-center">Xác nhận</th>
								<th class="text-center">Hành Động</th>
							</tr>
						</thead>
						<tbody>
							<tr th:each="hd : ${hds}">
								<td class="text-start text-center" th:text="${hd.hoaDonId}"><input
									type="hidden" name="hoaDonId" th:value="${hd.hoaDonId}" /></td>
								<td class="text-start text-center"
									th:text="${#dates.format(hd.ngayTao, 'dd/MM/yyyy')}"></td>
								<td class="text-start text-center" th:text="${hd.taiKhoans.hoTen}"></td>
								<td class="text-start"><select name="choXacNhan" style="border: none; background-color: transparent;"
									th:value="${hd.choXacNhan}" class="choXacNhanSelect w-100 text-center">
										<option th:each="entry : ${trangThaiMap}"
											th:value="${entry.key}" th:text="${entry.value}"
											th:selected="${hd.choXacNhan == entry.key}"></option>
								</select></td>
								<td><a style="text-decoration: none;"
									th:href="@{/employee/quanli/quanlihoadon/xem/{hoaDonId}(hoaDonId=${hd.hoaDonId})}">
										<button class="btn btn-secondary">In bill</button>
								</a>
									<button type="button" class="btn btn-secondary updateBtn"
										th:data-id="${hd.hoaDonId}">Lưu</button></td>
							</tr>
						</tbody>

					</table>
				</div>
			</div>
			<div class="col-sm-4">
				<div class="form-container">
					<div class="title text-center">
						<h3 class="fw-bold">HÓA ĐƠN BÁN HÀNG</h3>
						<p class="mb-0">
							Địa chỉ: 27 Đ. Nam Kỳ Khởi Nghĩa, Tân An <br> Q. Ninh Kiều -
							TP. Cần Thơ
						</p>
						<p>ĐT: 0328.059.731</p>
					</div>
					<div class="d-flex justify-content-between" th:each="hd : ${hdfs}">
						<div>
							<p class="mb-0">
								Ngày: <label for="date" th:text="${hd.ngayTao}"></label>
							<p>
								Khách hàng: <label for="text" th:text="${hd.taiKhoans.hoTen}"></label>
							</p>
						</div>
						<div>
							<p>
								Số: HD<label for="text" th:text="${hd.hoaDonId}"></label>
							</p>
						</div>
					</div>
					<div
						class="card p-2 border-start-0 border-end-0 border border-dark rounded-0">
						<table class="table table-borderless">
							<thead>
								<tr>
									<th>Mặt hàng</th>
									<th>SL</th>
									<th>Giá</th>
									<th>T tiền</th>
								</tr>
							</thead>
							<tbody>
								<tr th:each="ct : ${cts}">
									<td class="text-start" th:text="${ct.sanPhams.tenSanPham}"></td>
									<td th:text="${ct.soLuong}"></td>
									<td th:text="${#numbers.formatCurrency(ct.sanPhams.giaBan)}"></td>
									<td th:text="${#numbers.formatCurrency(ct.donGia)}"></td>
								</tr>
								<!-- Thêm các dòng hóa đơn khác -->
							</tbody>

						</table>

					</div>
					<div>
						<h4 class="pt-2 d-flex justify-content-between"
							th:each="hd : ${hdfs}">
							<label>Tổng tiền:</label> <label for="text"
								th:text="${#numbers.formatCurrency(hd.tongTien)}"></label>
						</h4>
					</div>
				</div>
				<div class="mt-3 float-end">
					<button type="button" class="btn btn-secondary"
						onclick="window.print()">In Hóa Đơn</button>
				</div>
			</div>
		</div>
	</div>

	<!-- Include jQuery -->
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

	<script>
		$(document)
				.ready(
						function() {
							// Khi nhấn nút "Lưu"
							$(".updateBtn")
									.click(
											function() {
												var hoaDonId = $(this).data(
														"id"); // Lấy ID hóa đơn từ data-id
												var choXacNhan = $(this)
														.closest("tr")
														.find(
																"select[name='choXacNhan']")
														.val(); // Lấy giá trị chọn từ select

												// Gửi yêu cầu AJAX
												$
														.ajax({
															url : '/employee/quanli/quanlihoadon/capnhat', // Đường dẫn đến controller
															type : 'POST',
															data : {
																hoaDonId : hoaDonId,
																choXacNhan : choXacNhan
															},
															success : function(
																	response) {
																alert("Cập nhật thành công!");
																// Có thể làm mới bảng hoặc làm gì đó khi thành công
															},
															error : function(
																	xhr,
																	status,
																	error) {
																alert("Đã có lỗi xảy ra: "
																		+ error);
															}
														});
											});
						});
	</script>
	<!--JavaScript Libraries -->
	<script th:src="@{/js/reload.js}"></script>
	<script th:src="@{/js/chart.js}"></script>
	<script th:src="@{/js/page.js}"></script>
	<script th:src="@{/js/app.js}"></script>
	<script th:src="@{/js/script-admin.js}"></script>
	<script th:src="@{/js/app.js}"></script>
	<!-- =================================== -->

	<!-- <script src="script.js"></script> -->
	<script
		src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
		integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
		crossorigin="anonymous"></script>

	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js"
		integrity="sha384-BBtl+eGJRgqQAUMxJ7pMwbEyER4l1g+O15P+16Ep7Q9Q+zqX6gSbd85u4mG4QzX+"
		crossorigin="anonymous"></script>

</body>

</html>