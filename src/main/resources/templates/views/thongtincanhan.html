<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org"
	xmlns:sec="https://www.thymeleaf.org/thymeleaf-extras-springsecurity6">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Thông tin của tôi</title>
    <!-- ===== Boxicons CSS ===== -->
    <link
      href="https://unpkg.com/boxicons@2.1.1/css/boxicons.min.css"
      rel="stylesheet"
    />
    <!-- Linking Google Font Link For Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Nunito+Sans:ital,opsz,wght@0,6..12,200..1000;1,6..12,200..1000&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
      rel="stylesheet"
    />
    <!--<link rel="stylesheet" href="style2.css" />-->
    <link rel="stylesheet" th:href="@{/css/style-profile.css}" />
    <link rel="stylesheet" th:href="@{/css/style-error.css}" />

    <!-- Bootstrap CSS v5.2.1 -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
      crossorigin="anonymous"
    />
    <!-- (Optional) Use CSS or JS implementation -->
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/js/all.min.js"
      integrity="sha512-naukR7I+Nk6gp7p5TMA4ycgfxaZBJ7MO5iC3Fp6ySQyKFHOGfpkSZkYVWV5R7u7cfAicxanwYQ5D1e17EfJcMA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <script
      type="text/javascript"
      src="https://www.gstatic.com/charts/loader.js"
    ></script>
  </head>

  <body>
    <aside th:replace="~{views/layout/aside-profile :: aside}"></aside>
	<div class="main-content">
		<nav th:replace="~{views/layout/nav-profile :: nav}"></nav>
      <div class="box-work">
        <div class="title">
          <h1><b>Thông Tin</b> <span class="edit_text-title">Hồ Sơ</span></h1>
        </div>
        <hr />
        <div class="row mt-5">
          <!-- Khu vực ảnh đại diện -->
          <div class="col-sm-3 d-flex flex-column align-items-center">
            <img
              src="/assets/images/admin/meomeoooo.jpg"
              alt="Profile Image"
              class="profile-image"
              id="profileImage"
            />
            <input
              type="file"
              id="uploadImage"
              accept="image/*"
              style="display: none"
            />
            <!-- Nút Chỉnh Sửa Ảnh nằm ngay dưới ảnh -->
            <button
              type="button"
              class="btn btn-outline-primary edit-image-btn"
              id="editImageButton"
            >
              <i class="fa-solid fa-user-pen"></i> Chỉnh Sửa
            </button>
          </div>

          <!-- Form Chỉnh Sửa Thông Tin -->
          <div class="col-sm-9 mb-5">
            <form th:action="@{/profile/update}" th:object="${taiKhoan}" id="userForm" novalidate method="post">
             <input type="hidden" th:field="*{taiKhoanId}" />
              <!-- Họ tên -->
              <div class="mb-3">
                <label for="fullName" class="form-label">Họ tên</label>
                <input
                  type="text"
                  class="form-control"
                  id="fullName"
                  th:field="*{hoTen}"
                  required
                />
                <div class="invalid-feedback fw-bold">
                  Vui lòng nhập họ tên.
                </div>
              </div>

              <!-- Số điện thoại -->
              <div class="mb-3">
                <label for="phoneNumber" class="form-label"
                  >Số điện thoại (+84)</label
                >
                <input
                  type="tel"
                  class="form-control"
                  id="phoneNumber"
                  pattern="[0-9]{9}"
                  th:field="*{soDienThoai}"
                  required
                />
                <div class="invalid-feedback fw-bold">
                  Vui lòng nhập số điện thoại hợp lệ.
                </div>
              </div>

              <!-- Email -->
              <div class="mb-3">
                <label for="email" class="form-label">Email</label>
                <input
                  type="email"
                  class="form-control"
                  id="email"
                  th:field="*{email}"
                  required
                />
                <div class="invalid-feedback fw-bold">
                  Vui lòng nhập địa chỉ email hợp lệ.
                </div>
              </div>
              <!-- Giới tính -->
              <div class="mb-3">
                <label class="form-label">Giới tính</label>
                <div>
                  <div class="form-check form-check-inline">
                    <input
                      class="form-check-input"
                      type="radio"
                      name="gender"
                      id="male"
                     value="false"
                      th:field="*{gioiTinh}"
                      required
                    />
                    <label class="form-check-label" for="male">Nam</label>
                  </div>
                  <div class="form-check form-check-inline">
                    <input
                      class="form-check-input"
                      type="radio"
                      name="gender"
                      id="female"
                       value="true"
                      th:field="*{gioiTinh}"
                    />
                    <label class="form-check-label" for="female">Nữ</label>
                  </div>
                </div>
                <div class="invalid-feedback fw-bold">
                  Vui lòng chọn giới tính.
                </div>
              </div>

              <!-- Ngày sinh -->
              <div class="mb-3">
                <label for="dob" class="form-label">Ngày sinh</label>
                <input type="date" class="form-control" id="dob" required th:field="*{ngaySinh}"/>
                
              </div>

              <!-- Nút Chỉnh sửa và Quay về -->
              <div class="form-actions formcn text-end">
                <button type="submit" class="btn btn-primary" id="editButton">
                  Chỉnh Sửa
                </button>
                <a class="btn btn-primary" th:href="@{/views/changePassword}">Đổi mật khẩu </a>
                <button
                  type="button"
                  class="btn btn-secondary"
                  id="backButton"
                  style="display: none"
                >
                  Quay về
                </button>
              </div>
              
            </form>
          </div>
          <div id="notification" th:if="${message}" class="notification" style="width: 400px">
			<div class="notification-header">
				<i class="icon">ℹ️</i> <span class="notification-title">Thông
					báo</span>
				<button class="close-btn" onclick="closeNotification()">✖</button>
			</div>
			<div class="notification-body">
				<p th:text="${message}"></p>
			</div>
		</div>
		<div id="notification" th:if="${error}" class="notification" style="width: 400px">
			<div class="notification-header">
				<i class="icon">ℹ️</i> <span class="notification-title">Thông
					báo</span>
				<button class="close-btn" onclick="closeNotification()">✖</button>
			</div>
			<div class="notification-body">
				<p th:text="${error}"></p>
			</div>
		</div>
          <hr class="mb-5" />
        </div>
      </div>
    </div>
    <script>
      const editButton = document.getElementById("editButton");
      const backButton = document.getElementById("backButton");
      const formInputs = document.querySelectorAll("#userForm input");
      const editImageButton = document.getElementById("editImageButton");
      const uploadImage = document.getElementById("uploadImage");
      const profileImage = document.getElementById("profileImage");

      let originalValues = {}; // Để lưu trữ giá trị ban đầu của form

      // Lưu trữ giá trị ban đầu
      formInputs.forEach((input) => {
        if (input.type !== "file") {
          originalValues[input.id] = input.value;
        }
      });

      // Hàm chuyển giữa chế độ chỉnh sửa và lưu
      editButton.addEventListener("click", function () {
        if (editButton.innerText === "Chỉnh Sửa") {
          // Chuyển sang chế độ chỉnh sửa
          formInputs.forEach((input) => (input.disabled = false)); // Mở khóa các input
          editButton.innerText = "Lưu"; // Thay đổi nội dung nút thành Lưu
          backButton.style.display = "inline-block"; // Hiện nút Quay về
          editImageButton.style.display = "inline-block"; // Hiện nút Chỉnh Sửa Ảnh
        } else {
            // Chuyển sang chế độ lưu
            const form = document.getElementById("userForm");
            if (form.checkValidity()) {
              // Kiểm tra tính hợp lệ của form
              formInputs.forEach((input) => {
                input.disabled = true; // Khóa các input
                originalValues[input.id] = input.value; // Cập nhật giá trị ban đầu
              });
              editButton.innerText = "Chỉnh Sửa"; // Thay đổi nội dung nút thành Chỉnh Sửa
              backButton.style.display = "none"; // Ẩn nút Quay về
              alert("Thông tin đã được lưu.");
            } else {
              form.classList.add("was-validated"); // Hiển thị lỗi nếu form không hợp lệ
            }
          }
      });

      // Nút Quay về
      backButton.addEventListener("click", function () {
        formInputs.forEach((input) => {
          input.disabled = true; // Khóa các input
          if (originalValues[input.id] !== undefined) {
            input.value = originalValues[input.id]; // Đặt lại giá trị ban đầu
          }
        });
        editButton.innerText = "Chỉnh Sửa"; // Đặt lại nội dung nút thành Chỉnh Sửa
        backButton.style.display = "none"; // Ẩn nút Quay về
        editImageButton.style.display = "none"; // Ẩn nút Chỉnh Sửa Ảnh
      });

      // Hàm chỉnh sửa ảnh
      editImageButton.addEventListener("click", function () {
        uploadImage.click(); // Mở hộp thoại chọn ảnh
      });

      // Khi người dùng chọn ảnh mới
      uploadImage.addEventListener("change", function (event) {
        const file = event.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = function (e) {
            profileImage.src = e.target.result; // Thay đổi ảnh đại diện
          };
          reader.readAsDataURL(file); // Đọc ảnh
        }
      });
      function closeNotification() {
          const notification = document.getElementById("notification");
          notification.style.display = "none";
      }
      // Tự động ẩn thông báo sau 5 giây
      setTimeout(() => {
          const notification = document.getElementById("notification");
          if (notification) {
              notification.style.display = "none";
          }
      }, 3000);
    </script>
    <!--JavaScript Libraries -->
	<script src="../../../js/reload.js"></script>
	<script src="../../../js/chart.js"></script>
	<script src="../../../js/page.js"></script>
	<script src="../../../js/app.js"></script>
    <!-- =================================== -->

    <!-- <script src="script.js"></script> -->
    <script
      src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
      integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
      crossorigin="anonymous"
    ></script>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js"
      integrity="sha384-BBtl+eGJRgqQAUMxJ7pMwbEyER4l1g+O15P+16Ep7Q9Q+zqX6gSbd85u4mG4QzX+"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
